

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Events &mdash; Minos Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CQRS" href="cqrs.html" />
    <link rel="prev" title="Data Model" href="data_model.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Minos Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/_toc.html">QuickStart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">Architecture</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="data_model.html">Data Model</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#producer-broker">Producer (Broker)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#consumer">Consumer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cqrs.html">CQRS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ports_and_adapters.html">Ports and Adapters</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest_handler.html">REST Handler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Minos Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="_toc.html">Architecture</a> &raquo;</li>
        
      <li>Events</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/architecture/events.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="events">
<h1>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>An event is a change in state, or an update, like an item being placed in a shopping cart on an e-commerce website.
Events can either carry the state (the item purchased, its price, and a delivery address) or events can be identifiers
(a notification that an order was shipped).</p>
<p>Key components: event <code class="docutils literal notranslate"><span class="pre">producers</span></code> and event <code class="docutils literal notranslate"><span class="pre">consumers</span></code>.
A producer publishes an event to the Kafka and the consumer reads them.
Producer services and consumer services are decoupled, which allows them to be scaled, updated,
and deployed independently.</p>
<p>Each component and its operation is detailed below.</p>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Events are stored in a PostgreSQL database before being sent to Kafka. This plays an important role as it allows
messages to be transactional and fault tolerant (network errors, Kafka crashes…).</p>
<p>Once the messages are successfully published in Kafka, they are removed from PostgreSQL and a notification
is sent (using PostgreSQL <a class="reference external" href="https://www.postgresql.org/docs/9.1/sql-listen.html">LISTEN</a> /
<a class="reference external" href="https://www.postgresql.org/docs/9.1/sql-notify.html">NOTIFY</a> ) to consumers so that they can consume it.
(As you can see, this is done in a reactive way so that there does not have to be
a periodic background process that checks every x seconds for new messages for example. This reduces the overall
consumption of each microservice).</p>
<p>&#64;startuml
actor Producer
database DB
database Kafka
actor Consumer</p>
<p>autonumber
Producer -&gt; DB: Store Event
DB -&gt; Kafka: Publish Event
DB -&gt; Consumer: Notify
Consumer –&gt; DB: Get Event
&#64;enduml</p>
</div>
<div class="section" id="producer-broker">
<h2>Producer (Broker)<a class="headerlink" href="#producer-broker" title="Permalink to this headline">¶</a></h2>
<p>It is responsible for <strong>storing</strong> the event in the <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> database, <strong>sending</strong> it to <code class="docutils literal notranslate"><span class="pre">Kafka</span></code>, <strong>deleting</strong> it from <code class="docutils literal notranslate"><span class="pre">PotgreSQL</span></code>
(if it has been successfully sent to Kafka) and <strong>notifying</strong> the consumer that the event can be consumed.</p>
<p>Let’s take a step-by-step look at what a Producer does:</p>
<ol class="arabic">
<li><p>Stores the <code class="docutils literal notranslate"><span class="pre">Event</span></code> in databaseThe events have several <strong>attempts</strong> to be stored in the database (parameterizable). As an example, we set the number of
retries to 3, if on the third attempt the event is not stored in the database because it is not a valid event, it
is marked to not be processed any more times.</p>
<blockquote>
<div><p>&#64;startuml
participant Event
database DB</p>
<p>autonumber
Event -&gt;x DB: Store Event</p>
</div></blockquote>
<p>Event -&gt;x DB: Store Event
Event -&gt;x DB: Store Event
Event -&gt; Message: Marked for no further processing</p>
<blockquote>
<div><p>&#64;enduml</p>
</div></blockquote>
</li>
<li><p>Publish <code class="docutils literal notranslate"><span class="pre">Event</span></code> to <code class="docutils literal notranslate"><span class="pre">Kafka</span></code></p></li>
</ol>
<p>&#64;startuml
participant Event
database DB
database Kafka</p>
<p>autonumber
Event -&gt; DB: Store Event
DB -&gt; Kafka: Publish Event
DB -&gt;x Consumer: Notify
&#64;enduml</p>
</div>
<div class="section" id="consumer">
<h2>Consumer<a class="headerlink" href="#consumer" title="Permalink to this headline">¶</a></h2>
<p>TODO</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="cqrs.html" class="btn btn-neutral float-right" title="CQRS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="data_model.html" class="btn btn-neutral float-left" title="Data Model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Clariteia.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>