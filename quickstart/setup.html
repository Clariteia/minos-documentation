

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Setup &mdash; Minos Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Aggregate" href="aggregate.html" />
    <link rel="prev" title="QuickStart" href="_toc.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Minos Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_toc.html">QuickStart</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modularity">Modularity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-managers">Package Managers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#poetry">Poetry</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="aggregate.html">Aggregate</a></li>
<li class="toctree-l2"><a class="reference internal" href="service.html">Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="saga.html">Saga</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html">Deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/_toc.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Minos Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="_toc.html">QuickStart</a> &raquo;</li>
        
      <li>Setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/quickstart/setup.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Before starting to think in multiple microservices, distributed environments and so on, it’s easier and better to start
by knowing what components are needed to build a microservice individually. For sake of simplicity, each microservice
can be seen as one small monolithic system that provides as limited or specialized functionality. Then, each
microservice will probably need to interact with a storage system, contain some kind of business logic and expose that
functionality over an external API, to be used by external clients and another microservices.</p>
</div>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>To be able to provide all that environment functionalities, <code class="docutils literal notranslate"><span class="pre">minos</span></code> relies on external dedicated libraries. For example,
to read or store data in postgres database <code class="docutils literal notranslate"><span class="pre">aiopg</span></code> is used, to publish or subscribe to kafka topics <code class="docutils literal notranslate"><span class="pre">aiokafka</span></code> is used
and to expose a REST interface <code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> is used. In any case, the <code class="docutils literal notranslate"><span class="pre">minos</span></code> philosophy is that the surrounding
technologies must not be frozen to these and each of project must have its own ones so the list of supported databases
and brokers will be increased in future <code class="docutils literal notranslate"><span class="pre">minos</span></code> releases.</p>
<p>Another important thing to know is that <code class="docutils literal notranslate"><span class="pre">minos</span></code> relies on latest <code class="docutils literal notranslate"><span class="pre">Python</span></code> functionalities so the minimal required
version is <code class="docutils literal notranslate"><span class="pre">3.9</span></code> or greater. One of the reasons are the use of <em>async</em> code together with <em>type hinted</em> code.</p>
<p>Then, for this quickstart the following dependencies are needed:</p>
<ul class="simple">
<li><p><strong>Python</strong> &gt;= 3.9</p></li>
<li><p><strong>PostgreSQL</strong> &gt;= 9.3</p></li>
<li><p><strong>Kafka</strong> &gt;= 2.8</p></li>
</ul>
<p>In order to ease the quickstart process, here is a simple <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> that provides the environment
dependencies:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># docker-compose.yml</span>

<span class="nt">version</span><span class="p">:</span> <span class="s">&quot;3.9&quot;</span>
<span class="nt">services</span><span class="p">:</span>
  <span class="nt">postgres</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">postgres:latest</span>
    <span class="nt">ports</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;5432:5432&quot;</span>
    <span class="nt">environment</span><span class="p">:</span>
      <span class="nt">POSTGRES_USER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos</span>
      <span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">min0s</span>
      <span class="nt">POSTGRES_DB</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">exam_db</span>
  <span class="nt">zookeeper</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wurstmeister/zookeeper:latest</span>
    <span class="nt">ports</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;2181:2181&quot;</span>
  <span class="nt">kafka</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wurstmeister/kafka:latest</span>
    <span class="nt">ports</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;9092:9092&quot;</span>
    <span class="nt">depends_on</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">zookeeper</span>
    <span class="nt">environment</span><span class="p">:</span>
      <span class="nt">KAFKA_ADVERTISED_HOST_NAME</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">KAFKA_ZOOKEEPER_CONNECT</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zookeeper:2181</span>
      <span class="nt">KAFKA_DELETE_TOPIC_ENABLE</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="modularity">
<h2>Modularity<a class="headerlink" href="#modularity" title="Permalink to this headline">¶</a></h2>
<p>Another important detail about how the <code class="docutils literal notranslate"><span class="pre">minos</span></code> framework is how it is packaged. Instead of providing all the framework
as a single and big component, it relies
on <code class="docutils literal notranslate"><span class="pre">Python</span></code> <a class="reference external" href="https://packaging.python.org/guides/packaging-namespace-packages/">namespaces</a> to provide a modular but
organized way to install only the exact part of functionality that will be used. The main packages are the following
ones:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pypi.org/project/minos-microservice-common/">minos-microservice-common</a>: Contains the <code class="docutils literal notranslate"><span class="pre">minos.common</span></code> module.</p></li>
<li><p><a class="reference external" href="https://pypi.org/project/minos-microservice-networks/">minos-microservice-networks</a>:  Contains the <code class="docutils literal notranslate"><span class="pre">minos.networks</span></code>
module.</p></li>
<li><p><a class="reference external" href="https://pypi.org/project/minos-microservice-saga/">minos-microservice-saga</a>: Contains the <code class="docutils literal notranslate"><span class="pre">minos.saga</span></code> module.</p></li>
<li><p><a class="reference external" href="https://pypi.org/project/minos-microservice-cqrs/">minos-microservice-cqrs</a>: Contains the <code class="docutils literal notranslate"><span class="pre">minos.cqrs</span></code> module.</p></li>
</ul>
</div>
<div class="section" id="package-managers">
<h2>Package Managers<a class="headerlink" href="#package-managers" title="Permalink to this headline">¶</a></h2>
<p>Before starting a <code class="docutils literal notranslate"><span class="pre">Python</span></code> project, a package manager is needed to install and manage external dependencies. As it’s
expected, <code class="docutils literal notranslate"><span class="pre">minos</span></code> is compatible with any of them, but the recommended one is <code class="docutils literal notranslate"><span class="pre">Poetry</span></code> as it provides simple but powerful
functionalities.</p>
<div class="section" id="poetry">
<h3>Poetry<a class="headerlink" href="#poetry" title="Permalink to this headline">¶</a></h3>
<p>To install poetry, it’s recommended to follow its own guide, that can be found <a class="reference external" href="https://python-poetry.org/docs/">here</a>.
After installing <code class="docutils literal notranslate"><span class="pre">poetry</span></code>, everything is ready to build the first microservice!</p>
<p>The first step is to create the project (the project name can be whatever you want, but a <code class="docutils literal notranslate"><span class="pre">minos</span></code> microservice
convention is to name it as <code class="docutils literal notranslate"><span class="pre">src</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry new exam-microservice-example --name src
</pre></div>
</div>
<p>The project structure will be similar to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>exam-microservice-example
├── README.rst
├── pyproject.toml
├── src
│   └── __init__.py
└── tests
    ├── __init__.py
    └── test_src.py

<span class="m">2</span> directories, <span class="m">5</span> files
</pre></div>
</div>
<p>To install the <code class="docutils literal notranslate"><span class="pre">minos</span></code> dependencies, simply exec the following command on the project’s root directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry add <span class="se">\</span>
  minos-microservice-common <span class="se">\</span>
  minos-microservice-networks <span class="se">\</span>
  minos-microservice-saga <span class="se">\</span>
  minos-microservice-cqrs
</pre></div>
</div>
<p>After that, every <code class="docutils literal notranslate"><span class="pre">minos</span></code> dependencies are ready to be used. Let’s move to the configuration step!</p>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># config.yml</span>

<span class="nt">service</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">exam</span>
  <span class="nt">aggregate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src.aggregates.Exam</span>
  <span class="nt">injections</span><span class="p">:</span>
    <span class="nt">postgresql_pool</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.common.PostgreSqlPool</span>
    <span class="nt">command_broker</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.CommandBroker</span>
    <span class="nt">command_reply_broker</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.CommandReplyBroker</span>
    <span class="nt">event_broker</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.EventBroker</span>
    <span class="nt">consumer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.Consumer</span>
    <span class="nt">dynamic_handler_pool</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.DynamicHandlerPool</span>
    <span class="nt">repository</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.common.PostgreSqlRepository</span>
    <span class="nt">saga_manager</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.saga.SagaManager</span>
    <span class="nt">snapshot</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.common.PostgreSqlSnapshot</span>
    <span class="nt">discovery</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.DiscoveryConnector</span>
  <span class="nt">services</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.ConsumerService</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.CommandHandlerService</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.CommandReplyHandlerService</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.EventHandlerService</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.RestService</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.SnapshotService</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.ProducerService</span>
<span class="nt">rest</span><span class="p">:</span>
  <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0</span>
  <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8082</span>
<span class="nt">broker</span><span class="p">:</span>
  <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9092</span>
  <span class="nt">queue</span><span class="p">:</span>
    <span class="nt">database</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">exam_db</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">min0s</span>
    <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
    <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5432</span>
    <span class="nt">records</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000</span>
    <span class="nt">retry</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">repository</span><span class="p">:</span>
  <span class="nt">database</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">exam_db</span>
  <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos</span>
  <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">min0s</span>
  <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5432</span>
<span class="nt">snapshot</span><span class="p">:</span>
  <span class="nt">database</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">exam_db</span>
  <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos</span>
  <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">min0s</span>
  <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5432</span>
<span class="nt">events</span><span class="p">:</span>
  <span class="nt">service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src.ExamQueryService</span>
<span class="nt">queries</span><span class="p">:</span>
  <span class="nt">service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src.ExamQueryService</span>
<span class="nt">commands</span><span class="p">:</span>
  <span class="nt">service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src.ExamCommandService</span>
<span class="nt">saga</span><span class="p">:</span>
  <span class="nt">storage</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./exam.lmdb</span>
<span class="nt">discovery</span><span class="p">:</span>
  <span class="nt">client</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minos.networks.MinosDiscoveryClient</span>
  <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5567</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="aggregate.html" class="btn btn-neutral float-right" title="Aggregate" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="_toc.html" class="btn btn-neutral float-left" title="QuickStart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Clariteia.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>